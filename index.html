<!doctype html>
<html lang="pt-BR" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel de Tickets • Novetech</title>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {},
          boxShadow: { card: "0 2px 20px -4px rgba(0,0,0,.08)" }
        }
      },
      darkMode: 'media'
    }
  </script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- Chart.js for charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    .glass { backdrop-filter: blur(8px); background: rgba(255,255,255,.7); }
    @media (prefers-color-scheme: dark){ .glass{ background: rgba(24,24,27,.6);} }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-zinc-50 to-zinc-100 dark:from-zinc-950 dark:to-zinc-900 text-zinc-900 dark:text-zinc-50">
  <!-- Topbar -->
  <header class="sticky top-0 z-10 glass border-b border-zinc-200/70 dark:border-zinc-800/70">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span class="inline-flex items-center justify-center w-9 h-9 rounded-xl bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 font-semibold">NT</span>
        <div>
          <h1 class="text-base font-semibold leading-tight">Painel de Tickets</h1>
          <p class="text-xs text-zinc-500 -mt-0.5">Novetech • exemplo front‑end (HTML)</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-zinc-200 dark:border-zinc-800 text-sm hover:bg-zinc-50 dark:hover:bg-zinc-800">
          <i data-lucide="settings" class="w-4 h-4"></i> Preferências
        </button>
        <button class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 text-sm shadow">
          <i data-lucide="plus" class="w-4 h-4"></i> Novo Ticket
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6 space-y-4">
    <!-- KPIs -->
    <section id="kpis" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></section>

    <!-- Toolbar header -->
    <section class="flex items-center justify-between">
      <div class="flex items-center gap-2 text-sm text-zinc-500">
        <i data-lucide="filter" class="w-4 h-4"></i> Filtros
      </div>
      <div id="teamSummary" class="text-xs text-zinc-400">Equipe ativa: 0 <i data-lucide="users" class="inline w-3 h-3 ml-1"></i></div>
    </section>

    <!-- Toolbar -->
    <section class="glass rounded-2xl p-4 border border-zinc-200 dark:border-zinc-800 shadow-sm">
      <div class="grid grid-cols-1 md:grid-cols-12 gap-3 items-center">
        <div class="md:col-span-4 flex items-center gap-2">
          <div class="relative flex-1">
            <i data-lucide="search" class="w-4 h-4 absolute left-2 top-1/2 -translate-y-1/2 text-zinc-400"></i>
            <input id="q" placeholder="Buscar por título, ID, responsável..." class="w-full pl-8 pr-3 py-2 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 text-sm focus:outline-none focus:ring-2 focus:ring-zinc-300 dark:focus:ring-zinc-700" />
          </div>
        </div>
        <div class="md:col-span-6 grid grid-cols-2 md:grid-cols-4 gap-2">
          <select id="fStatus" class="px-3 py-2 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 text-sm">
            <option value="">Status</option>
            <option>Aberto</option>
            <option>Em Progresso</option>
            <option>Resolvido</option>
          </select>
          <select id="fPriority" class="px-3 py-2 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 text-sm">
            <option value="">Prioridade</option>
            <option>Crítica</option>
            <option>Alta</option>
            <option>Média</option>
            <option>Baixa</option>
          </select>
          <input id="fStart" type="date" class="px-3 py-2 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 text-sm" />
          <input id="fEnd" type="date" class="px-3 py-2 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 text-sm" />
        </div>
        <div class="md:col-span-2 flex justify-end gap-2">
          <button id="btnExport" class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-zinc-200 dark:border-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-800 text-sm">
            <i data-lucide="download" class="w-4 h-4"></i> Exportar CSV
          </button>
          <button id="btnReset" class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-zinc-200 dark:border-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-800 text-sm">
            <i data-lucide="refresh-cw" class="w-4 h-4"></i> Limpar
          </button>
        </div>
      </div>
    </section>

    <!-- Charts -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      <div class="glass rounded-2xl p-4 border border-zinc-200 dark:border-zinc-800">
        <h3 class="text-sm font-semibold mb-2">Tickets por Status</h3>
        <canvas id="chartStatus" height="230"></canvas>
      </div>
      <div class="glass rounded-2xl p-4 border border-zinc-200 dark:border-zinc-800">
        <h3 class="text-sm font-semibold mb-2">Abertos x Resolvidos (por dia)</h3>
        <canvas id="chartDay" height="230"></canvas>
      </div>
    </section>

    <!-- Table -->
    <section class="glass rounded-2xl p-3 border border-zinc-200 dark:border-zinc-800 shadow-sm">
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm" id="tbl">
          <thead>
            <tr class="text-left text-zinc-500 border-b border-zinc-200 dark:border-zinc-800">
              <th class="py-3 px-3">Ticket</th>
              <th class="py-3 px-3">Título</th>
              <th class="py-3 px-3">Status</th>
              <th class="py-3 px-3">Prioridade</th>
              <th class="py-3 px-3">Responsável</th>
              <th class="py-3 px-3">Canal</th>
              <th class="py-3 px-3">Criado</th>
              <th class="py-3 px-3">Atualizado</th>
              <th class="py-3 px-3">SLA (h)</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div class="flex justify-between items-center px-3 py-3">
        <p id="pagingText" class="text-xs text-zinc-500"></p>
        <div class="flex items-center gap-2">
          <button id="prev" class="px-3 py-1.5 rounded-lg border text-sm disabled:opacity-40">Anterior</button>
          <span id="pageInfo" class="text-xs text-zinc-500">1/1</span>
          <button id="next" class="px-3 py-1.5 rounded-lg border text-sm disabled:opacity-40">Próxima</button>
        </div>
      </div>
    </section>

    <footer class="py-6 text-center text-xs text-zinc-400">
      Construído em HTML + Tailwind + Chart.js + Lucide. Substitua o mock por sua API ✨
    </footer>
  </main>

  <script>
    // ===== Mock de dados (substitua por fetch da sua API) =====
    const seedTickets = [
      { id: "NT-1001", title: "Erro 500 ao salvar formulário", status: "Aberto", priority: "Alta", assignee: "Yasmin", createdAt: "2025-10-01", updatedAt: "2025-10-03", slaHours: 48, timeToFirstResponseHrs: 2, tags: ["PEC", "Infra"], channel: "Email" },
      { id: "NT-1002", title: "Impressora da UBS Tibau sem conexão", status: "Em Progresso", priority: "Média", assignee: "Luan", createdAt: "2025-10-02", updatedAt: "2025-10-04", slaHours: 72, timeToFirstResponseHrs: 1, tags: ["Hardware"], channel: "Telefone" },
      { id: "NT-1003", title: "Cadastro duplicado em Santa Rita", status: "Aberto", priority: "Alta", assignee: "Raquel", createdAt: "2025-10-04", updatedAt: "2025-10-05", slaHours: 24, timeToFirstResponseHrs: 0.5, tags: ["PEC", "Dados"], channel: "Portal" },
      { id: "NT-1004", title: "App AtendSaúde não sincroniza", status: "Resolvido", priority: "Alta", assignee: "Josinaldo", createdAt: "2025-10-03", updatedAt: "2025-10-06", slaHours: 48, timeToFirstResponseHrs: 0.8, tags: ["Mobile", "AtendSaúde"], channel: "Portal" },
      { id: "NT-1005", title: "Queda intermitente no servidor", status: "Aberto", priority: "Crítica", assignee: "Marcelo", createdAt: "2025-10-05", updatedAt: "2025-10-07", slaHours: 12, timeToFirstResponseHrs: 0.2, tags: ["Infra"], channel: "Monitoramento" },
      { id: "NT-1006", title: "Dúvida sobre Portaria 3493 no PEC", status: "Resolvido", priority: "Baixa", assignee: "Tiago", createdAt: "2025-10-01", updatedAt: "2025-10-02", slaHours: 96, timeToFirstResponseHrs: 3, tags: ["Regulatório"], channel: "Email" },
      { id: "NT-1007", title: "Lentidão no módulo de prescrições", status: "Em Progresso", priority: "Média", assignee: "Yasmin", createdAt: "2025-10-06", updatedAt: "2025-10-07", slaHours: 72, timeToFirstResponseHrs: 1.5, tags: ["Performance"], channel: "Portal" },
      { id: "NT-1008", title: "Integração com BI falhando", status: "Aberto", priority: "Alta", assignee: "Luan", createdAt: "2025-10-07", updatedAt: "2025-10-07", slaHours: 24, timeToFirstResponseHrs: 0.3, tags: ["BI", "API"], channel: "Webhook" },
    ];

    // ===== Estado =====
    let tickets = [...seedTickets];
    let query = '';
    const filters = { status: '', priority: '', startDate: '', endDate: '' };
    let page = 1; const pageSize = 6;

    // ===== Helpers =====
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const unique = (arr) => Array.from(new Set(arr));

    const statusClass = (st) => ({
      'Aberto': 'bg-amber-100 text-amber-800 border-amber-200',
      'Em Progresso': 'bg-blue-100 text-blue-800 border-blue-200',
      'Resolvido': 'bg-emerald-100 text-emerald-800 border-emerald-200',
    })[st] || '';

    const priorityClass = (p) => ({
      'Crítica': 'bg-red-100 text-red-800 border-red-200',
      'Alta': 'bg-orange-100 text-orange-800 border-orange-200',
      'Média': 'bg-yellow-100 text-yellow-800 border-yellow-200',
      'Baixa': 'bg-emerald-100 text-emerald-800 border-emerald-200',
    })[p] || '';

    function applyFilters(){
      const q = query.toLowerCase();
      return tickets.filter(t => {
        const matchQ = !q || [t.id,t.title,t.assignee,t.channel,...(t.tags||[])].join(' ').toLowerCase().includes(q);
        const matchS = !filters.status || t.status === filters.status;
        const matchP = !filters.priority || t.priority === filters.priority;
        const matchD1 = !filters.startDate || t.createdAt >= filters.startDate;
        const matchD2 = !filters.endDate || t.createdAt <= filters.endDate;
        return matchQ && matchS && matchP && matchD1 && matchD2;
      });
    }

    function kpiData(rows){
      const total = rows.length;
      const abertos = rows.filter(t => t.status !== 'Resolvido').length;
      const resolvidos = rows.filter(t => t.status === 'Resolvido').length;
      const slaOK = rows.filter(t => t.timeToFirstResponseHrs <= 4).length; // exemplo
      const equipes = unique(rows.map(t=>t.assignee)).length;
      return { total, abertos, resolvidos, slaOK, equipes };
    }

    function renderKPIs(rows){
      const { total, abertos, resolvidos, slaOK } = kpiData(rows);
      const tpl = (title, value, subtitle, icon) => `
        <div class="glass border border-zinc-200 dark:border-zinc-800 rounded-2xl p-5 shadow-sm hover:shadow-md transition">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-zinc-500">${title}</p>
              <p class="mt-1 text-2xl font-semibold tracking-tight">${value}</p>
              ${subtitle?`<p class="mt-2 text-xs text-zinc-400">${subtitle}</p>`:''}
            </div>
            <i data-lucide="${icon}" class="w-6 h-6 text-zinc-400"></i>
          </div>
        </div>`;
      $('#kpis').innerHTML = [
        tpl('Tickets', total, 'Total filtrado', 'tag'),
        tpl('Em aberto', abertos, 'Aguardando solução', 'alert-triangle'),
        tpl('Resolvidos', resolvidos, 'Últimos registros', 'check-circle-2'),
        tpl('SLA OK', `${slaOK}/${total||1}`, '1ª resposta ≤ 4h', 'clock'),
      ].join('');
      lucide.createIcons();
    }

    function renderTable(rows){
      const totalPages = Math.max(1, Math.ceil(rows.length / pageSize));
      page = Math.min(page, totalPages);
      const start = (page-1)*pageSize; const end = Math.min(page*pageSize, rows.length);
      const pageRows = rows.slice(start, end);
      $('#tbody').innerHTML = pageRows.map(t=>`
        <tr class="border-b border-zinc-100 dark:border-zinc-800 hover:bg-zinc-50/60 dark:hover:bg-zinc-800/40">
          <td class="py-3 px-3 font-medium text-zinc-800 dark:text-zinc-100">${t.id}</td>
          <td class="py-3 px-3 text-zinc-700 dark:text-zinc-300">${t.title}</td>
          <td class="py-3 px-3"><span class="inline-flex items-center px-2 py-0.5 text-xs font-medium border rounded-full ${statusClass(t.status)}">${t.status}</span></td>
          <td class="py-3 px-3"><span class="inline-flex items-center px-2 py-0.5 text-xs font-medium border rounded-full ${priorityClass(t.priority)}">${t.priority}</span></td>
          <td class="py-3 px-3">${t.assignee}</td>
          <td class="py-3 px-3">${t.channel}</td>
          <td class="py-3 px-3">${t.createdAt}</td>
          <td class="py-3 px-3">${t.updatedAt}</td>
          <td class="py-3 px-3">${t.slaHours}</td>
        </tr>
      `).join('');
      $('#pagingText').textContent = rows.length ? `Mostrando ${start+1}-${end} de ${rows.length}` : '0 resultados';
      $('#pageInfo').textContent = `${page}/${totalPages}`;
      $('#prev').disabled = page===1; $('#next').disabled = page===totalPages;
    }

    // ===== Charts =====
    let chartStatus, chartDay;
    function renderCharts(rows){
      const byStatus = rows.reduce((acc,t)=>{ acc[t.status]=(acc[t.status]||0)+1; return acc; },{});
      const statusLabels = Object.keys(byStatus);
      const statusValues = Object.values(byStatus);

      const byDayMap = new Map();
      rows.forEach(t=>{
        const d = t.createdAt;
        const obj = byDayMap.get(d) || { day: d, criados: 0, resolvidos: 0 };
        obj.criados += 1;
        if(t.status === 'Resolvido') obj.resolvidos += 1;
        byDayMap.set(d, obj);
      });
      const byDay = Array.from(byDayMap.values()).sort((a,b)=>a.day.localeCompare(b.day));

      // Destroy previous
      chartStatus && chartStatus.destroy();
      chartDay && chartDay.destroy();

      chartStatus = new Chart($('#chartStatus'), {
        type: 'bar',
        data: { labels: statusLabels, datasets: [{ label: 'Tickets', data: statusValues, borderRadius: 6 }] },
        options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { precision:0 }}}}
      });

      chartDay = new Chart($('#chartDay'), {
        type: 'line',
        data: { labels: byDay.map(x=>x.day), datasets: [
          { label: 'Criados', data: byDay.map(x=>x.criados), tension:.4, borderWidth:2 },
          { label: 'Resolvidos', data: byDay.map(x=>x.resolvidos), tension:.4, borderWidth:2 }
        ]},
        options: { responsive: true, scales: { y: { beginAtZero: true, ticks: { precision:0 }}}}
      });
    }

    // ===== Export CSV =====
    function exportCSV(rows){
      const headers = ['id','title','status','priority','assignee','channel','createdAt','updatedAt','slaHours','timeToFirstResponseHrs','tags'];
      const data = rows.map(t=>[
        t.id,
        '"'+String(t.title).replaceAll('"','""')+'"',
        t.status, t.priority, t.assignee, t.channel,
        t.createdAt, t.updatedAt, t.slaHours, t.timeToFirstResponseHrs,
        '"'+(t.tags||[]).join('|')+'"'
      ].join(','));
      const csv = [headers.join(','), ...data].join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `tickets_export_${new Date().toISOString().slice(0,10)}.csv`;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    // ===== Wire-up =====
    function refresh(){
      const rows = applyFilters();
      renderKPIs(rows);
      renderCharts(rows);
      renderTable(rows);
      const teamSize = unique(rows.map(t=>t.assignee)).length;
      $('#teamSummary').innerHTML = `Equipe ativa: ${teamSize} <i data-lucide="users" class="inline w-3 h-3 ml-1"></i>`;
      lucide.createIcons();
    }

    function reset(){
      $('#q').value = filters.status = filters.priority = filters.startDate = filters.endDate = '';
      query = '';
      page = 1; refresh();
    }

    // Events
    window.addEventListener('DOMContentLoaded', () => {
      lucide.createIcons();
      $('#q').addEventListener('input', (e)=>{ query = e.target.value; page=1; refresh(); });
      $('#fStatus').addEventListener('change', (e)=>{ filters.status = e.target.value; page=1; refresh(); });
      $('#fPriority').addEventListener('change', (e)=>{ filters.priority = e.target.value; page=1; refresh(); });
      $('#fStart').addEventListener('change', (e)=>{ filters.startDate = e.target.value; page=1; refresh(); });
      $('#fEnd').addEventListener('change', (e)=>{ filters.endDate = e.target.value; page=1; refresh(); });
      $('#btnExport').addEventListener('click', ()=> exportCSV(applyFilters()));
      $('#btnReset').addEventListener('click', reset);
      $('#prev').addEventListener('click', ()=>{ if(page>1){ page--; refresh(); }});
      $('#next').addEventListener('click', ()=>{ page++; refresh(); });
      refresh();
    });
  </script>
</body>
</html>
